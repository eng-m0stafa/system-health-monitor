name: ğŸ¥ Health Monitor CI/CD

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    name: ğŸ§ª Run Tests
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v3
    
    - name: ğŸ”§ Make scripts executable
      run: chmod +x scripts/*.sh
    
    - name: ğŸ§ª Run test suite
      run: ./scripts/test.sh
    
    - name: âœ… Test health check execution
      run: |
        echo "Testing health check script..."
        ./scripts/health-check.sh
        echo "Health check completed successfully!"

  build:
    name: ğŸ³ Build Docker Image
    needs: test
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v3
    
    - name: ğŸ³ Build Docker image
      run: docker build -t health-monitor:latest .
    
    - name: ğŸ§ª Test Docker container
      run: |
        echo "Testing Docker container..."
        docker run --rm health-monitor:latest > docker-output.txt
        
        # Check if output was generated
        if [ -s docker-output.txt ]; then
          echo "âœ… Container test passed!"
          echo "Container output preview:"
          head -5 docker-output.txt
        else
          echo "âŒ Container test failed - no output"
          exit 1
        fi
    
    - name: ğŸ“Š Show build summary
      run: |
        echo "ğŸ‰ Build completed successfully!"
        docker images health-monitor:latest